#####################################
# Instructions for LED Setup and Usage #
#####################################

# 1. Ensure the LEDs are set up correctly in your hardware.
# 2. Add the following macros to your existing G-code macros to call up the LED effects.
#    - Example: Add STATUS_LEVELING to the beginning of your QGL gcode macro, and add STATUS_READY to the end.
#    - Example: Add STATUS_CLEANING to the beginning of your nozzle-cleaning macro, and STATUS_READY to the end.
# 3. You can modify the colors of each macro or create new ones.
# 4. For more complex animations, you may need to use WLED with Moonraker and a micro-controller.

#####################################
#       END INSTRUCTIONS           #
#####################################

##########################
# LED Effects Animations #
##########################

# LED effect when the system is busy (e.g., in progress)
[led_effect led_busy]
autostart:              false            # Do not start automatically when powered on
frame_rate:             24               # Animation speed in frames per second
leds:
    neopixel:my_led     # Target the neopixel LEDs
layers:
    breathing  3 1 top (1,0,0)  # Breathing effect with red color (RGB: 1, 0, 0)

# LED effect during cleaning
[led_effect led_cleaning]
autostart:              false            # Do not start automatically
frame_rate:             24               # Animation speed
leds:
    neopixel:my_led     # Target the neopixel LEDs
layers:
    breathing  3 1 top (0.0, 0.02, 0.5)  # Breathing effect with blueish color

# LED effect when calibrating Z axis
[led_effect led_calibrating_z]
autostart:              false
frame_rate:             24
leds:
    neopixel:my_led     # Target the neopixel LEDs
layers:
    breathing  3 1 top (0.0, 0.0, 0.35)  # Breathing effect with light blue color

# LED effect while heating (e.g., pre-heating the extruder)
[led_effect led_heating]
leds:
    neopixel:my_led     # Target the neopixel LEDs
autostart:              false
frame_rate:             24
layers:
    breathing  3 1 top (1, 0.18, 0)  # Breathing effect with orange color

# LED effect while cooling (e.g., after heating)
[led_effect led_cooling]
leds:
    neopixel:my_led     # Target the neopixel LEDs
autostart:              false
frame_rate:             24
layers:
    breathing  3 1 top (0, 0, 1)  # Breathing effect with blue color

# LED effect during homing (e.g., homing the printer's axis)
[led_effect led_homing]
autostart:              false
frame_rate:             24
leds:
    neopixel:my_led     # Target the neopixel LEDs
layers:
    breathing  3 1 top (0.8, 0.6, 0.0)  # Breathing effect with yellow color

# LED effect during leveling (e.g., leveling the print bed)
[led_effect led_leveling]
autostart:              false
frame_rate:             24
leds:
    neopixel:my_led     # Target the neopixel LEDs
layers:
    breathing  3 1 top (0.5, 0.1, 0.4)  # Breathing effect with purple color

# LED effect during meshing (e.g., mesh bed leveling)
[led_effect led_meshing]
autostart:              false
frame_rate:             24
leds:
    neopixel:my_led     # Target the neopixel LEDs
layers:
    breathing  3 1 top (0.2, 1.0, 0.0)  # Breathing effect with green color

# LED effect while printing (e.g., printing in progress)
[led_effect led_printing]
autostart:              false
frame_rate:             24
leds:
    neopixel:my_led     # Target the neopixel LEDs
layers:
    gradient  0.3  1 add (0.3, 0.0, 0.0), (0.3, 0.3, 0.0), (0.3, 0.1, 0.0)  # Gradient effect from red to yellow

# LED effect when in standby (idle state)
[led_effect led_standby]
autostart:              true
frame_rate:             24
leds:
    neopixel:my_led     # Target the neopixel LEDs
layers:
    breathing  12 1 divide (1, 1, .6)
    static 1 0 top (.75, .75, .2)

# LED effect for part readiness (e.g., part is ready for removal)
[led_effect led_part_ready]
autostart:              false
frame_rate:             24
leds:
    neopixel:my_led     # Target the neopixel LEDs
layers:
    breathing  3 1 top (0.0, 1.0, 0.0)  # Green breathing effect indicating readiness

######################
## Critical Error LED ##
######################

# LED effect for critical error (e.g., system failure)
[led_effect sb_critical_error]
leds:
    neopixel:my_led     # Target the neopixel LEDs
layers:
    strobe 1 1.5 add (1.0, 1.0, 1.0)   # White strobe effect for critical error
    breathing 2 0 difference (0.95, 0.0, 0.0)  # Red warning breathing effect
    static 1 0 top (1.0, 0.0, 0.0)  # Solid red static light for error
autostart: false
frame_rate: 24
run_on_error: true  # Triggered only when a critical error occurs

# LED effect for rainbow animation (optional)
# [led_effect rainbow]
# leds:
#     neopixel:my_led
# autostart: true  # Start automatically
# frame_rate: 24  # Animation speed
# layers:
#     gradient 0.3 1 add (0.3, 0.0, 0.0), (0.0, 0.3, 0.0), (0.0, 0.0, 0.3)  # RGB gradient transition

#######################
# LED Effects Statics #
#######################

# Static LED effect for nozzle LEDs (turn off nozzle LEDs)
[led_effect set_nozzle_leds]
leds:
    neopixel:my_led     # Target the neopixel LEDs
autostart: false
frame_rate: 24
layers:
    static 0 0 top (0.0, 0.0, 0.0, 1.0)  # Static off effect for nozzle LEDs

# Static LED effect for general LEDs (turn on general LEDs with white light)
[led_effect set_led_leds]
leds:
    neopixel:my_led     # Target the neopixel LEDs
autostart: false
frame_rate: 24
layers:
    static 0 0 top (1.0, 1.0, 1.0)  # Static white light effect for general LEDs

##############
# The Macros #
##############

# Macro to turn off general LEDs
[gcode_macro set_led_leds_off]
gcode:
    SET_LED_EFFECT EFFECT=set_led_leds STOP=1  # Stop the LED effect

# Macro to turn on general LEDs
[gcode_macro set_led_leds_on]
gcode:
    SET_LED_EFFECT EFFECT=set_led_leds  # Turn on the LED effect

# Macro to turn on nozzle LEDs
[gcode_macro set_nozzle_leds_on]
gcode:
    SET_LED_EFFECT EFFECT=set_nozzle_leds  # Turn on the nozzle LED effect

# Macro to turn off nozzle LEDs
[gcode_macro set_nozzle_leds_off]
gcode:
    SET_LED_EFFECT EFFECT=set_nozzle_leds STOP=1  # Stop the nozzle LED effect

# Macro to stop all LED effects
[gcode_macro status_off]
gcode:
    STOP_LED_EFFECTS  # Stop all active LED effects

# Macro to set LEDs to "ready" state (rainbow effect)
[gcode_macro status_ready]
gcode:
    STOP_LED_EFFECTS  # Stop any active LED effects
    SET_LED_EFFECT EFFECT=rainbow  # Set the LEDs to rainbow effect for ready state

# Macro to set LEDs to "part ready" state (green)
[gcode_macro status_part_ready]
gcode:
    STOP_LED_EFFECTS  # Stop any active LED effects
    SET_LED_EFFECT EFFECT=sb_nozzle_part_ready  # Part ready effect for nozzle
    SET_LED_EFFECT EFFECT=led_part_ready  # Part ready effect for general LEDs

# Macro to set LEDs to "busy" state (red)
[gcode_macro status_busy]
gcode:
    STOP_LED_EFFECTS  # Stop any active LED effects
    SET_LED_EFFECT EFFECT=led_busy  # Set the busy LED effect
    set_nozzle_leds_on  # Turn on nozzle LEDs

# Macro to set LEDs to "heating" state (orange)
[gcode_macro status_heating]
gcode:
    STOP_LED_EFFECTS  # Stop any active LED effects
    SET_LED_EFFECT EFFECT=led_heating  # Heating effect
    SET_LED_EFFECT EFFECT=sb_nozzle_heating  # Heating effect for nozzle LEDs

# Macro to set LEDs to "cooling" state (blue)
[gcode_macro status_cooling]
gcode:
    STOP_LED_EFFECTS  # Stop any active LED effects
    SET_LED_EFFECT EFFECT=led_cooling  # Cooling effect
    SET_LED_EFFECT EFFECT=sb_nozzle_cooling  # Cooling effect for nozzle LEDs

# Macro to set LEDs to "leveling" state (purple)
[gcode_macro status_leveling]
gcode:
    STOP_LED_EFFECTS  # Stop any active LED effects
    SET_LED_EFFECT EFFECT=led_leveling  # Leveling effect
    set_nozzle_leds_on  # Turn on nozzle LEDs

# Macro to set LEDs to "homing" state (yellow)
[gcode_macro status_homing]
gcode:
    STOP_LED_EFFECTS  # Stop any active LED effects
    SET_LED_EFFECT EFFECT=led_homing  # Homing effect
    set_nozzle_leds_on  # Turn on nozzle LEDs

# Macro to set LEDs to "cleaning" state (blue)
[gcode_macro status_cleaning]
gcode:
    STOP_LED_EFFECTS  # Stop any active LED effects
    SET_LED_EFFECT EFFECT=led_cleaning  # Cleaning effect
    set_nozzle_leds_on  # Turn on nozzle LEDs

# Macro to set LEDs to "meshing" state (green)
[gcode_macro status_meshing]
gcode:
    STOP_LED_EFFECTS  # Stop any active LED effects
    SET_LED_EFFECT EFFECT=led_meshing  # Meshing effect
    set_nozzle_leds_on  # Turn on nozzle LEDs

# Macro to set LEDs to "calibrating Z" state
[gcode_macro status_calibrating_z]
gcode:
    STOP_LED_EFFECTS  # Stop any active LED effects
    SET_LED_EFFECT EFFECT=led_calibrating_z  # Calibrating effect
    set_nozzle_leds_on  # Turn on nozzle LEDs
